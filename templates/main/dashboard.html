{% extends 'common/base.html' %}
{% load static %}

{% block content %}

<section class="bg-pink-50 flex-grow flex items-center justify-center py-8">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-6xl p-8 space-y-8">

        <!-- Section Header -->
        <header class="text-center mb-4">
            <h2 class="text-3xl font-semibold italic text-pink-600">Hey {{ user.username }}!</h2>
        </header>

        <!-- Two Columns -->
        <div class="grid md:grid-cols-2">
            <!-- Left Column -->
            <section class="relative text-center space-y-6 p-2">
                <!-- Posts Section -->
                <div class="bg-pink-100 rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-bold text-pink-700 mb-4">Posts</h2>

                    <!-- My Posts -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-pink-600 mb-2">My Posts</h3>
                        <ul class="list-none list-inside text-sm text-gray-700 space-y-2 max-h-40 overflow-y-auto">
                            {% for post in my_posts %}
                                <li>
                                    <a href="{% url 'post-details' post.pk %}"
                                       class="flex justify-between items-center px-3 py-1 rounded hover:bg-pink-50 hover:text-pink-600 transition">
                                       <span class="max-w-xs">{{ post.title|truncatechars:30  }}</span>
                                        <span class="ml-2 inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full">
                                            {{ post.comments.count }} comments
                                        </span>
                                    </a>
                                </li>
                            {% empty %}
                                <li class="text-gray-700 italic">No posts yet.</li>
                            {% endfor %}
                        </ul>
                    </div>

                    <hr class="my-4 border-t border-pink-300">

                    <!-- Fav Posts -->
                    <div>
                        <h3 class="text-lg font-semibold text-pink-600 mb-2">Fav Posts</h3>
                        <ul class="list-none list-inside text-sm text-gray-700 space-y-2 max-h-40 overflow-y-auto">
                            {% for post in fav_posts %}
                                <li>
                                    <a href="{% url 'post-details' post.pk %}"
                                       class="flex justify-between items-center px-3 py-1 rounded hover:bg-pink-50 hover:text-pink-600 transition">
                                        <span class="max-w-xs">{{ post.title|truncatechars:30  }}</span>
                                        <span class="ml-2 inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full">
                                            {{ post.comments.count }} comments
                                        </span>
                                    </a>
                                </li>
                            {% empty %}
                                <li class="text-gray-700 italic">No posts yet.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <!-- Challenges Section -->
                <div class="bg-pink-100 rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-bold text-pink-700 mb-4">Challenges</h2>

                    <!-- My Challenges -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-pink-600 mb-1">My Challenges</h3>
                        <ul class="list-none list-inside text-sm text-gray-700 space-y-2 max-h-40 overflow-y-auto">
                            {% for challenge in my_challenges %}
                                <li>
                                    <a href="{% url 'challenge-details' challenge.pk %}"
                                       class="flex justify-between items-center px-3 py-1 rounded hover:bg-pink-50 hover:text-pink-600 transition">
                                        <span class="max-w-xs">{{ challenge.title|truncatechars:30  }}</span>
                                        <div class="flex space-x-2 ml-4 flex-shrink-0">
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ challenge.comments.count }} comments
                                            </span>
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ challenge.attendees.count }} attending
                                            </span>
                                        </div>

                                    </a>
                                </li>
                            {% empty %}
                                <li class="text-gray-700 italic">No challenges yet.</li>
                            {% endfor %}
                        </ul>
                    </div>

                    <hr class="my-4 border-t border-pink-300">

                    <!-- Fav Challenges -->
                    <div>
                        <h3 class="text-lg font-semibold text-pink-600 mb-1">Fav Challenges</h3>
                        <ul class="list-none list-inside text-sm text-gray-700 space-y-2 max-h-40 overflow-y-auto">
                            {% for challenge in fav_challenges %}
                               <li>
                                    <a href="{% url 'challenge-details' challenge.pk %}"
                                       class="flex justify-between items-center px-3 py-1 rounded hover:bg-pink-50 hover:text-pink-600 transition">
                                        <span class="max-w-xs">{{ challenge.title|truncatechars:30  }}</span>
                                        <div class="flex space-x-2 ml-4 flex-shrink-0">
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ challenge.comments.count }} comments
                                            </span>
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ challenge.attendees.count }} attending
                                            </span>
                                        </div>

                                    </a>
                                </li>
                            {% empty %}
                                <li class="text-gray-700 italic">No challenges yet.</li>
                            {% endfor %}
                        </ul>
                    </div>

                    <hr class="my-4 border-t border-pink-300">

                    <!-- Joined Challenges -->
                    <div>
                        <h3 class="text-lg font-semibold text-pink-600 mb-1">Joined Challenges</h3>
                        <ul class="list-none list-inside text-sm text-gray-700 space-y-2 max-h-40 overflow-y-auto">
                            {% for challenge in joined_challenges %}
                                <li>
                                    <a href="{% url 'challenge-details' challenge.pk %}"
                                       class="flex justify-between items-center px-3 py-1 rounded hover:bg-pink-50 hover:text-pink-600 transition">
                                        <span class="max-w-xs">{{ challenge.title|truncatechars:30  }}</span>
                                        <div class="flex space-x-2 ml-4 flex-shrink-0">
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ challenge.comments.count }} comments
                                            </span>
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ challenge.attendees.count }} attending
                                            </span>
                                        </div>

                                    </a>
                                </li>

                            {% empty %}
                                <li class="text-gray-700 italic">No challenges yet.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

            </section>

            <!-- Right Column -->
            <section class="relative text-center space-y-6 p-2">
                <div class="bg-pink-100 rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-bold text-pink-700 mb-4">Events</h2>

                    <!-- My Events -->
                    <div class="mb-6">
                        {% if perms.event.add_event %}
                        <h3 class="text-lg font-semibold text-pink-600 mb-1">My Events</h3>
                        <ul class="list-none list-inside text-sm text-gray-700 space-y-2 max-h-40 overflow-y-auto">
                            {% for event in my_events %}
                                <li>
                                    <a href="{% url 'event-details' event.pk %}"
                                       class="flex justify-between items-center px-3 py-1 rounded hover:bg-pink-50 hover:text-pink-600 transition">
                                        <span class="max-w-xs">{{ event.title|truncatechars:30  }}</span>
                                        <div class="flex space-x-2 ml-4 flex-shrink-0">
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ event.comments.count }} comments
                                            </span>
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ event.attendees.count }} attending
                                            </span>
                                        </div>
                                    </a>
                                </li>
                            {% empty %}
                                <li class="text-gray-700 italic">No challenges yet.</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>

                    {% if my_events %}
                    <hr class="my-4 border-t border-pink-300">
                    {% endif %}

                    <!-- Fav Events -->
                    <div>
                        <h3 class="text-lg font-semibold text-pink-600 mb-1">Fav Events</h3>
                        <ul class="list-none list-inside text-sm text-gray-700 space-y-2 max-h-40 overflow-y-auto">
                            {% for event in fav_events %}
                                <li>
                                    <a href="{% url 'event-details' event.pk %}"
                                       class="flex justify-between px-3 py-1 rounded hover:bg-pink-50 hover:text-pink-600 transition">
                                       <span class="max-w-xs">{{ event.title|truncatechars:30  }}</span>
                                        <div class="flex space-x-2 ml-4 flex-shrink-0">
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ event.comments.count }} comments
                                            </span>
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ event.attendees.count }} attending
                                            </span>
                                        </div>
                                    </a>
                                </li>
                            {% empty %}
                                <li class="text-gray-700 italic">No challenges yet.</li>
                            {% endfor %}
                        </ul>
                    </div>

                    <hr class="my-4 border-t border-pink-300">

                    <!-- Fav Events -->
                    <div>
                        <h3 class="text-lg font-semibold text-pink-600 mb-1">Joined Events</h3>
                        <ul class="list-none list-inside text-sm text-gray-700 space-y-2 max-h-40 overflow-y-auto">
                            {% for event in joined_events %}
                                <li>
                                    <a href="{% url 'event-details' event.pk %}"
                                       class="flex justify-between items-center px-3 py-1 rounded hover:bg-pink-50 hover:text-pink-600 transition">
                                        <span class="max-w-xs">{{ event.title|truncatechars:30  }}</span>
                                        <div class="flex space-x-2 ml-4 flex-shrink-0">
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ event.comments.count }} comments
                                            </span>
                                            <span class="inline-block bg-pink-200 text-pink-800 text-xs font-normal px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ event.attendees.count }} attending
                                            </span>
                                        </div>
                                    </a>
                                </li>
                            {% empty %}
                                <li class="text-gray-700 italic">No challenges yet.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <!-- Stats Section -->
                <div class="bg-pink-100  rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-bold text-pink-700 mb-4">Stats</h2>

                    <div class="text-center bg-white border-2 border-pink-300 rounded-2xl shadow-md">
                        <table class="w-full bg-white rounded-2xl overflow-hidden">
                            <thead class="text-pink-800">
                                <tr>
                                    <th class="px-4 py-3 text-center text-sm font-semibold"></th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Posts</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Events</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Challenges</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Total</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-pink-100">
                                <tr class="hover:bg-pink-50 transition">
                                    <td class="px-4 py-3 text-pink-700 font-medium text-center">Likes</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ liked_posts }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ liked_events }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ liked_challenges }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ likes.count }}</td>
                                </tr>

                                <tr class="hover:bg-pink-50 transition">
                                    <td class="px-4 py-3 text-pink-700 font-medium text-center">Favourites</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ fav_posts.count }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ fav_events.count }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ fav_challenges.count }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ favs.count }}</td>
                                </tr>

                                <tr class="hover:bg-pink-50 transition">
                                    <td class="px-4 py-3 text-pink-700 font-medium text-center">Comments</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ comments_posts }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ comments_events }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ comments_challenges }}</td>
                                    <td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ comments.count }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    {% if request.user.is_superuser %}

                        <hr class="my-4 border-t border-pink-300">
                        <h3 class="text-lg font-semibold text-pink-600 mb-1">Group Stats</h3>

                         <div class="text-center bg-white border-2 border-pink-300 rounded-2xl shadow-md">
                        <table class="w-full bg-white rounded-2xl overflow-hidden">
                            <thead class="text-pink-800">
                                <tr>
                                    <th class="px-4 py-3 text-center text-sm font-semibold"></th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Superusers</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Moderators</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Organizers</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Users</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-pink-100">
                                <tr class="hover:bg-pink-50 transition">
                                    <td class="px-4 py-3 text-pink-700 font-medium text-center">Total</td>

                                    {% if superusers %}
                                    	<td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ superusers }}</td>
                                    {% else %}
                                        <td class="px-4 py-3 text-pink-700 font-semibold text-center">0</td>
                                    {% endif %}

                                    {% if moderators %}
                                    	<td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ moderators }}</td>
                                    {% else %}
                                        <td class="px-4 py-3 text-pink-700 font-semibold text-center">0</td>
                                    {% endif %}

                                    {% if organizers %}
                                    	<td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ organizers }}</td>
                                    {% else %}
                                        <td class="px-4 py-3 text-pink-700 font-semibold text-center">0</td>
                                    {% endif %}

                                    {% if users %}
                                    	<td class="px-4 py-3 text-pink-700 font-semibold text-center">{{ users }}</td>
                                    {% else %}
                                        <td class="px-4 py-3 text-pink-700 font-semibold text-center">0</td>
                                    {% endif %}

                                </tr>
                            </tbody>
                        </table>
                         </div>
                    {% endif %}
                </div>
            </section>
        </div>
    </div>
</section>

{% endblock %}